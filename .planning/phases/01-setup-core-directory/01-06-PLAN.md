---
phase: 01-setup-core-directory
plan: 06
type: execute
wave: 3
depends_on: ["01-03", "01-05"]
files_modified:
  - src/app/(public)/listings/[id]/page.tsx
  - src/app/(public)/page.tsx
  - src/app/(public)/layout.tsx
  - src/lib/metadata/schema.ts
  - src/lib/accessibility/config.ts
autonomous: true

must_haves:
  truths:
    - "Listing pages appear in Google search results with rich snippets"
    - "All pages meet WCAG 2.1 AA accessibility standards"
    - "Page metadata accurately describes content"
  artifacts:
    - path: "src/lib/metadata/schema.ts"
      provides: "LocalBusiness schema markup generator"
      exports: ["generateListingSchema"]
    - path: "src/app/(public)/listings/[id]/page.tsx"
      provides: "Listing page with schema markup"
      contains: "application/ld+json"
    - path: "src/lib/accessibility/config.ts"
      provides: "ARIA labels and accessibility configuration"
      exports: ["ariaLabels"]
  key_links:
    - from: "src/app/(public)/listings/[id]/page.tsx"
      to: "src/lib/metadata/schema.ts"
      via: "Schema markup injection"
      pattern: "generateListingSchema"
---

<objective>
Implement SEO optimization with structured data and ensure WCAG 2.1 AA accessibility compliance across all pages.

Purpose: Make directory discoverable in search engines and accessible to all users, fulfilling UX-02 and UX-03 requirements.
Output: Listing pages with LocalBusiness schema markup, proper meta tags, and verified accessibility compliance.
</objective>

<execution_context>
@/Users/vincecain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vincecain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/vincecain/Projects/nextgen-preservation-directory/.planning/PROJECT.md
@/Users/vincecain/Projects/nextgen-preservation-directory/.planning/ROADMAP.md
@/Users/vincecain/Projects/nextgen-preservation-directory/.planning/STATE.md
@/Users/vincecain/Projects/nextgen-preservation-directory/.planning/phases/01-setup-core-directory/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Implement LocalBusiness schema markup for listings</name>
  <files>
    src/lib/metadata/schema.ts
    src/app/(public)/listings/[id]/page.tsx
  </files>
  <action>
    Create src/lib/metadata/schema.ts:
    - Export `generateListingSchema(listing: Listing)` function
    - Return Schema.org LocalBusiness JSON-LD object with:
      - @context: "https://schema.org"
      - @type: "LocalBusiness"
      - name, description, telephone, email, url (website)
      - address: PostalAddress with streetAddress, addressLocality: "Louisville", addressRegion: "KY", addressCountry: "US"
      - geo: GeoCoordinates with latitude, longitude
      - image: listing.image_url if present
    - Follow Schema.org LocalBusiness specification exactly

    Update src/app/(public)/listings/[id]/page.tsx:
    - Import generateListingSchema
    - Add script tag in page JSX:
      ```tsx
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(generateListingSchema(listing)) }}
      />
      ```
    - Enhance generateMetadata() to include:
      - OpenGraph tags (og:title, og:description, og:image, og:type: "business.business")
      - Twitter Card tags (twitter:card, twitter:title, twitter:description)
      - Canonical URL

    Per research: LocalBusiness schema required for Google rich results (Code Example from research). SEO structured data prevents Pitfall 7.
  </action>
  <verify>
    Navigate to a listing page and view page source
    Verify JSON-LD script tag is present in HTML
    Copy JSON-LD and validate at https://validator.schema.org/
    Use Google Rich Results Test: https://search.google.com/test/rich-results
  </verify>
  <done>
    LocalBusiness schema markup added to all listing pages, validates successfully, OpenGraph and Twitter Card tags present
  </done>
</task>

<task type="auto">
  <name>Add comprehensive meta tags and SEO optimization</name>
  <files>
    src/app/(public)/page.tsx
    src/app/(public)/layout.tsx
    src/app/(public)/map/page.tsx
  </files>
  <action>
    Add metadata to src/app/(public)/page.tsx (homepage):
    ```typescript
    export const metadata: Metadata = {
      title: 'NextGen Preservation Collab Directory - Louisville, KY',
      description: 'Find builders, craftspeople, architects, and preservation stakeholders in Louisville\'s historic preservation ecosystem.',
      keywords: 'Louisville preservation, historic renovation, preservation directory, Kentucky heritage',
      openGraph: {
        title: 'NextGen Preservation Collab Directory',
        description: 'Connect with Louisville\'s preservation community',
        type: 'website',
        url: 'https://[domain]',
      },
    };
    ```

    Update src/app/(public)/layout.tsx root metadata:
    - Set default meta description
    - Add viewport meta tag for responsive design
    - Add favicon and app icons
    - Set language: lang="en"
    - Add robots meta for indexing (allow)

    Update src/app/(public)/map/page.tsx metadata:
    - Title: "Map View - Preservation Directory"
    - Description with geographic keywords

    Create sitemap.ts and robots.txt in app directory for better crawling.

    Per research: Meta tags essential for SEO (UX-02 requirement). Robots and sitemap improve search engine discovery.
  </action>
  <verify>
    Run `npm run build` and check for Next.js metadata warnings
    View page source for each page type and verify meta tags present
    Check that viewport meta tag exists: <meta name="viewport" content="width=device-width, initial-scale=1" />
    Verify robots.txt is accessible at /robots.txt
  </verify>
  <done>
    All pages have proper meta tags, OpenGraph data, viewport configuration, robots.txt and sitemap generated
  </done>
</task>

<task type="auto">
  <name>Verify WCAG 2.1 AA accessibility compliance</name>
  <files>
    src/lib/accessibility/config.ts
    src/components/layout/Header.tsx
    src/components/layout/Footer.tsx
    src/components/listings/ListingCard.tsx
    src/components/map/MapView.tsx
  </files>
  <action>
    Create src/lib/accessibility/config.ts:
    - Export ARIA label constants for reusable components
    - Document accessibility features used across site

    Audit and fix components for WCAG 2.1 AA:

    **Header.tsx:**
    - Ensure nav has `role="navigation"` and `aria-label="Main navigation"`
    - Mobile menu button has `aria-expanded` and `aria-controls`
    - Skip to content link for keyboard users

    **Footer.tsx:**
    - Use semantic footer tag with `role="contentinfo"`
    - Ensure links have sufficient color contrast (check with browser DevTools)

    **ListingCard.tsx:**
    - Ensure clickable card has accessible name (heading is used for link text)
    - Alt text for images if present
    - Sufficient color contrast for text on card background

    **MapView.tsx:**
    - Map container has `role="region"` and `aria-label="Interactive map of listings"`
    - Provide keyboard-accessible alternative: link to "View as list" (already exists on /page.tsx)

    **Form inputs (SearchBar, FilterPanel):**
    - All inputs have associated labels (use htmlFor and id)
    - Select dropdowns have visible labels

    Install and run axe DevTools or Lighthouse accessibility audit.

    Per research: WCAG 2.1 AA compliance is UX-03 success criterion. Radix UI (used by shadcn/ui) provides accessible primitives, but custom components need manual verification.
  </action>
  <verify>
    Install axe DevTools browser extension
    Run accessibility audit on homepage, listing detail, and map pages
    Address all Critical and Serious issues
    Run Lighthouse accessibility audit (score should be 90+)
    Test keyboard navigation: Tab through all interactive elements
    Test with screen reader (macOS VoiceOver or NVDA) for major flows
  </verify>
  <done>
    All pages pass axe DevTools with zero Critical/Serious issues, Lighthouse accessibility score 90+, keyboard navigation works, ARIA labels configured
  </done>
</task>

</tasks>

<verification>
1. Listing pages have LocalBusiness schema markup that validates
2. All pages have proper meta tags, OpenGraph, and Twitter Cards
3. robots.txt and sitemap are accessible
4. axe DevTools shows zero Critical/Serious accessibility issues
5. Lighthouse accessibility score is 90+ for all page types
6. Keyboard navigation works for all interactive elements
7. Color contrast meets WCAG AA standards
</verification>

<success_criteria>
- LocalBusiness schema markup added to listing detail pages
- All pages have comprehensive meta tags and OpenGraph data
- WCAG 2.1 AA compliance verified with axe DevTools
- Lighthouse accessibility score 90+ across all pages
- Semantic HTML and ARIA labels used throughout
- Keyboard navigation fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/01-setup-core-directory/01-06-SUMMARY.md`
</output>
